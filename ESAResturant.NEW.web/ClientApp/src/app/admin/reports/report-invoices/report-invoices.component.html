<div class="reportPage">

  <div class="loading" *ngIf="loading==true">

    <!--<img  src="../../../assets//img//loading1.gif" />-->

    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; background: none; display: block; shape-rendering: auto;" width="211px" height="211px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
      <circle cx="50" cy="50" fill="none" stroke="#4164bd" stroke-width="10" r="34" stroke-dasharray="160.22122533307947 55.40707511102649" transform="rotate(89.4851 50 50)">
        <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="0.9345794392523364s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform>
      </circle>
      <!-- [ldio] generated by https://loading.io/ -->
    </svg>

  </div>

  <div class="repPageHeader">
    <h1>{{ 'ADMINSIDEBAR.BILLSREPORT' | translate }}</h1>
    <span>
      <a>
        <i class="fas fa-arrow-circle-left" (click)=" navigateBack()"></i>
      </a>
    </span>
    <a>
      <!-- <i class="fas fa-print "></i> -->
      <button mat-button [matMenuTriggerFor]="menu"><i class="fas fa-print "></i></button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="ClickResizePaper('printInvA5')">A5</button>
        <button mat-menu-item (click)="ClickResizePaper('printInvA4')">A4</button>
        <button mat-menu-item (click)="exportAsXLSX()">exel</button>
      </mat-menu>
    </a>
    <a>
      <i class="fas fa-share"></i>
    </a>
  </div>
  <div class="repPageBody">
    <div class="repPageSearch">
      <div class="repPageSearchElement repPageSearchDate">
        <label class="hiden-in-small">{{ 'LABELS.DATE' | translate }}</label>
        <mat-form-field class="date-padd" appearance="outline">
          <mat-label>  {{ 'REPORTS.FROM' | translate }}</mat-label>
          <input matInput type="date" [matDatepicker]="DateFrom" [(ngModel)]="fromDate">
          <mat-datepicker-toggle matSuffix [for]="DateFrom"></mat-datepicker-toggle>
          <mat-datepicker #DateFrom></mat-datepicker>
        </mat-form-field>
        <mat-form-field class="date-padd" appearance="outline">
          <mat-label>   {{ 'REPORTS.TO' | translate }}</mat-label>
          <input matInput type="date" [matDatepicker]="DateTo" [(ngModel)]="toDate">
          <mat-datepicker-toggle matSuffix [for]="DateTo"></mat-datepicker-toggle>
          <mat-datepicker #DateTo></mat-datepicker>
        </mat-form-field>
        <button mat-stroked-button (click)="getBillsPagginated()">{{ 'ACTIONS.SEARCH' | translate }}<i class="fas fa-search"></i></button>
        <!-- <div class="BtnResizePaper">
          <mat-icon>print</mat-icon>
          <button mat-stroked-button (click)="ClickResizePaper('printInvA5')">A5</button>
          <button mat-stroked-button (click)="ClickResizePaper('printInvA4')">A4</button>
          <button mat-stroked-button (click)="exportAsXLSX()"> exel </button>

        </div>  -->
      </div>
      <div class="repPageSearchElement hiden-in-small">
        <mat-form-field appearance="outline">
          <mat-label> {{ 'BILLREPORT.BILLNUMBER' | translate }} </mat-label>
          <input matInput type="number" [(ngModel)]="filterdbillVM.id" (input)="GetBillById()" (click)="$event.target.select()">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>  {{ 'BILLREPORT.BILLTYPE' | translate }}    </mat-label>
          <mat-select [(ngModel)]="filterdbillVM.billTypeId">
            <mat-option *ngIf="filterdbillVM.billTypeId==null"> {{ 'LABELS.BILLTYPE' | translate }}  </mat-option>
            <mat-option *ngFor="let item of billTypeList" [value]="item.id" (click)="GetBillTypeId()">
              {{item.nameAR}}
            </mat-option>
          </mat-select>
        </mat-form-field>



        <mat-form-field appearance="outline">
          <mat-label>  {{ 'LABELS.BILLPLACE' | translate }}    </mat-label>
          <mat-select [(ngModel)]="filterdbillVM.billPlaceId">
            <mat-option> {{ 'LABELS.BILLPLACE' | translate }}  </mat-option>
            <mat-option *ngFor="let place of billPlaceList" [value]="place.id" (click)="filterBillPlace()">
              {{place.nameAR}}
            </mat-option>
          </mat-select>
        </mat-form-field>


        <mat-form-field appearance="outline">
          <mat-label>{{ 'KITCHEN.REQUESTNUMBER' | translate }} </mat-label>
          <input matInput type="number" [(ngModel)]="filterdbillVM.orderNo" (input)="GetBillByDateAndOrderNo()" (click)="$event.target.select()">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>{{ 'LABELS.TOTAL' | translate }} </mat-label>
          <input matInput type="number" [(ngModel)]="filterdbillVM.netTotal" (input)="GetBillByDateAndNetTotal()" (click)="$event.target.select()">
        </mat-form-field>


        <mat-form-field appearance="outline" *ngIf="userType==1">
          <mat-label>  {{ 'USERS.USERS' | translate }}    </mat-label>
          <mat-select [(ngModel)]="filterdbillVM.userId">
            <mat-option *ngIf="currentLang=='ar'" value="الكل" (click)="getBillAll($event)">الكل</mat-option>
            <mat-option *ngIf="currentLang=='en'" value="all" (click)="getBillAll($event)">all</mat-option>
            <mat-option *ngFor="let user of usersList" [value]="user.id" (click)="filterByUser(user.id)">
              {{user.userName}}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </div>

      <mat-accordion class="repPageAdvanced show-in-small">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ 'BRANCHES.SERCH' | translate }}
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field appearance="outline">
            <mat-label>
              {{ 'BILLREPORT.BILLNUMBER' | translate }}
            </mat-label>
            <!--<input matInput #serch_item (input)="GetBillByDateAndId($event.target.value)" (click)="$event.target.select()">-->
            <input matInput [(ngModel)]="filterdbillVM.id" (input)="GetBillById()" (click)="$event.target.select()">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>
              {{ 'BILLREPORT.BILLTYPE' | translate }}
            </mat-label>
            <mat-select [(ngModel)]="filterdbillVM.billTypeId">
              <mat-option *ngIf="filterdbillVM.billTypeId==null"> {{ 'LABELS.BILLTYPE' | translate }}  </mat-option>

              <mat-option *ngFor="let item of billTypeList" [value]="item.id" (click)="GetBillTypeId()">
                {{item.nameAR}}
              </mat-option>
            </mat-select>
          </mat-form-field>


          <mat-form-field appearance="outline">
            <mat-label>  {{ 'LABELS.BILLPLACE' | translate }}    </mat-label>
            <mat-select [(ngModel)]="filterdbillVM.billPlaceId">
              <mat-option *ngIf="filterdbillVM.billPlaceId==null"> {{ 'LABELS.BILLTYPE' | translate }}  </mat-option>

              <mat-option *ngFor="let place of billPlaceList" [value]="place.id" (click)="filterBillPlace()">
                {{place.nameAR}}
              </mat-option>
            </mat-select>
          </mat-form-field>


          <mat-form-field appearance="outline">
            <mat-label>{{ 'KITCHEN.REQUESTNUMBER' | translate }} </mat-label>
            <input matInput type="number" [(ngModel)]="filterdbillVM.orderNo" (input)="GetBillByDateAndOrderNo()" (click)="$event.target.select()">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'LABELS.TOTAL' | translate }} </mat-label>
            <input matInput style="text-align:center" type="number" [(ngModel)]="filterdbillVM.netTotal" (input)="GetBillByDateAndNetTotal()" (click)="$event.target.select()">
          </mat-form-field>

          <mat-form-field appearance="outline" *ngIf="userType==1">
            <mat-label>  {{ 'USERS.USERS' | translate }}    </mat-label>
            <mat-select>
              <mat-option *ngIf="currentLang=='ar'" value="الكل" (click)="getBillAll($event)">الكل</mat-option>
              <mat-option *ngIf="currentLang=='en'" value="all" (click)="getBillAll($event)">all</mat-option>
              <mat-option *ngFor="let user of usersList" [value]="user.id" (click)="filterByUser(user.id)">
                {{user.userName}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <button mat-stroked-button (click)="getBillsPagginated()">{{ 'ACTIONS.SEARCH' | translate }}<i class="fas fa-search"></i></button>



        </mat-expansion-panel>
      </mat-accordion>
    </div>
    <div class="repPageTable">
      <div class="example-container mat-elevation-z8">
        <table class="table text-center">
          <thead class="thead-dark">
            <tr>
              <th>{{ 'ACTIONS.ID' | translate  }} </th>
              <th>{{ 'BILLREPORT.BILLNUMBER' | translate }} </th>
              <th>{{ 'LABELS.RequestNumber' | translate }} </th>
              <th>{{ 'LABELS.NAME' | translate }} </th>
              <th>
                {{ 'LABELS.BILLTYPE' | translate }}
              </th>
              <th>
                {{ 'LABELS.QUANTITY' | translate }}
              </th>
              <th>
                {{ 'LABELS.TOTAL' | translate }}
              </th>
              <th>
                {{ 'LABELS.DISCOUNT' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.SERVICEFEES' | translate }}
              </th>
              <th>
                {{ 'LABELS.VAT' | translate }}
              </th>
              <th>
                {{ 'LABELS.PAID' | translate }}
              </th>
              <th>
                {{ 'BILLINVOICE.NETTOTAL' | translate }}
              </th>
              <th>
                {{ 'USERS.USERNAME' | translate }}
              </th>
              <th>
                {{ 'LABELS.DATE' | translate }}
              </th>
              <th>
                {{ 'ACTIONS.EDIT' | translate }}
              </th>
              <th>
                {{ 'ACTIONS.Delete' | translate }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let bill of filterBill; let i = index;">
              <th scope="row">{{i+1}}</th>
              <td><span>{{bill.id}}</span></td>
              <td><span>{{bill.orderNo}}</span></td>
              <td><span>{{bill.pepoleName}}</span></td>
              <td><span style="font-size:12px; font-weight: bold;">{{currentLang=='ar'? bill.billType.nameAR : bill.billType.nameEN}}</span></td>
              <td><span>{{bill.totalQty}}</span></td>
              <td><span>{{bill.supTotal | number:'0.2-2'}}</span></td>
              <td><span>{{bill.currentDiscount}}</span></td>
              <td><span>{{bill.serviceFees | number:'0.2-2'}}</span></td>
              <td><span>{{bill.totalVatTax | number:'0.2-2'}}</span></td>
              <td><span>{{bill.paied | number:'0.2-2'}}</span></td>
              <td><span>{{bill.netTotal | number:'0.2-2'}}</span></td>
              <td><span>{{bill.user.userName}}</span></td>
              <td style="padding: 0px !important;"><span style="font-size: 14px;padding-top: 10px;display: block;width: 80px;">{{bill.date}}</span></td>
              <td>
                <button mat-icon-button aria-label="Example icon-button with a heart icon" [routerLink]="['../billInvoice/',bill.id]">
                  <i class="fas fa-pen"></i>
                </button>
              </td>
              <td>
                <button mat-icon-button aria-label="Example icon-button with a heart icon" (click)="deleteBill(deleteConfirm,bill)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="repAbstract hiden-in-small">
        <table>
          <thead>
            <tr>
              <th>
                {{ 'BILLREPORT.BILLCOUNT' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.BILLTOTAL' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.CASHCOUNT' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.VISATOTAL' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.AGELTOTAL' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.DICOUNTTOTAL' | translate }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tdCount"><span>{{ billTotals.totalBillCount }}</span></td>
              <td class="tdCreditor"><span>{{ billTotals.sumBillNetTotals | number:'0.2-2' }}</span></td>
              <td class="tdMoney"><span>{{ billTotals.sumBillCash | number:'0.2-2' }}</span></td>
              <td class="tdMoney"><span>{{ billTotals.sumBillVisa | number:'0.2-2' }}</span></td>
              <td class="tdMoney"><span>{{ billTotals.sumBillRemaining | number:'0.2-2' }}</span></td>
              <td class="tdDebtor"><span>{{ billTotals.totalDiscount | number:'0.2-2' }}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="repAbstract show-in-small">
        <table>
          <thead>
            <tr>
              <th>
                {{ 'BILLREPORT.BILLCOUNT' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.BILLTOTAL' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.CASHCOUNT' | translate }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tdCount"><span>{{ billTotals.totalBillCount }}</span></td>
              <td class="tdCreditor"><span>{{ billTotals.sumBillNetTotals | number:'0.2-2' }}</span></td>
              <td class="tdMoney"><span>{{ billTotals.sumBillCash | number:'0.2-2' }}</span></td>

            </tr>
          </tbody>
        </table>
      </div>
      <div class="repAbstract show-in-small">
        <table>
          <thead>
            <tr>
              <th>
                {{ 'BILLREPORT.VISATOTAL' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.AGELTOTAL' | translate }}
              </th>
              <th>
                {{ 'BILLREPORT.DICOUNTTOTAL' | translate }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tdMoney"><span>{{ billTotals.sumBillVisa | number:'0.2-2' }}</span></td>
              <td class="tdMoney"><span>{{ billTotals.sumBillRemaining | number:'0.2-2' }}</span></td>
              <td class="tdDebtor"><span>{{ billTotals.totalDiscount | number:'0.2-2' }}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div class="printableInv" id="printReptax" hidden>
  <div [class]="ResizePaper">
    <div class="printInvDetails">
      <div class="row">
        <div class="printInvDetailsAddress">
          <div class="PrintCompanyName">
            <h1> {{ 'BRANCHES.COMPANYNAME' | translate }} </h1>
          </div>
          <div class="PrintLogo">
            <img src="../../../../assets/img/Logo4.png" alt="Logo">
          </div>
        </div>
        <div class="PrintName text-center">
          <h2> {{ 'REPORTS.BILLREPORTS' | translate }} </h2>
        </div>
        <div class="PrintDate">
          <!-- <h3>التاريخ</h3> -->
          <p>{{ 'REPORTS.FROM' | translate }}: <strong>{{fromDate | date: 'yyyy-MM-dd'}}</strong></p>
          <p>{{ 'REPORTS.TO' | translate }}: <strong>{{toDate | date: 'yyyy-MM-dd'}}</strong></p>
        </div>
        <div class="PrintSearchType" *ngIf="BillTypeName != ''">
          <p>
            {{ 'LABELS.BILLTYPE' | translate }}: <strong>{{BillTypeName}}</strong>
          </p>
        </div>
      </div>
    </div>
    <div class="printInvTable text-center">
      <table>
        <thead>
          <tr>
            <th>{{ 'BILLREPORT.BILLNUMBER' | translate }} </th>
            <th>{{ 'LABELS.RequestNumber' | translate }} </th>
            <th>{{ 'LABELS.NAME' | translate }} </th>
            <th>
              {{ 'LABELS.BILLTYPE' | translate }}
            </th>
            <th>
              {{ 'LABELS.QUANTITY' | translate }}
            </th>
            <th>
              {{ 'LABELS.TOTAL' | translate }}
            </th>
            <th>
              {{ 'LABELS.DISCOUNT' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.SERVICEFEES' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.VATTAX' | translate }}
            </th>
            <th>
              {{ 'LABELS.PAID' | translate }}
            </th>
            <th>
              {{ 'BILLINVOICE.NETTOTAL' | translate }}
            </th>
            <th>
              {{ 'LABELS.DATE' | translate }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of filterBill">
            <td><span>{{bill.id}}</span></td>
            <td><span>{{bill.orderNo}}</span></td>
            <td><span>{{bill.pepoleName}}</span></td>
            <td><span>{{bill.billTypeName}}</span></td>
            <td><span>{{bill.totalQty}}</span></td>
            <td><span>{{bill.supTotal | number:'0.2-2'}}</span></td>
            <td><span>{{bill.currentDiscount}}</span></td>
            <td><span>{{bill.serviceFees | number:'0.2-2'}}</span></td>
            <td><span>{{bill.totalVatTax | number:'0.2-2'}}</span></td>
            <td><span>{{bill.paied | number:'0.2-2'}}</span></td>
            <td><span>{{bill.netTotal | number:'0.2-2'}}</span></td>
            <td><span>{{bill.currentDate | date: 'yyyy-MM-dd'}}</span></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="repAbstract">
      <table>
        <thead>
          <tr>
            <th>
              {{ 'BILLREPORT.BILLCOUNT' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.BILLTOTAL' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.CASHCOUNT' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.VISATOTAL' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.AGELTOTAL' | translate }}
            </th>
            <th>
              {{ 'BILLREPORT.DICOUNTTOTAL' | translate }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="tdCount"><span>{{ billTotals.totalBillCount }}</span></td>
            <td class="tdCreditor"><span>{{ billTotals.sumBillNetTotals | number:'0.2-2' }}</span></td>
            <td class="tdMoney"><span>{{ billTotals.sumBillCash | number:'0.2-2' }}</span></td>
            <td class="tdMoney"><span>{{ billTotals.sumBillVisa | number:'0.2-2' }}</span></td>
            <td class="tdMoney"><span>{{ billTotals.sumBillRemaining | number:'0.2-2' }}</span></td>
            <td class="tdDebtor"><span>{{ billTotals.totalDiscount | number:'0.2-2' }}</span></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="printInvFooter">
      <p>
        Power By Easacc<br />
        www.EasAcc.com
      </p>
    </div>
  </div>
</div>


<ng-template #deleteConfirm>
  <div class="modal-body text-center">
    <p>{{ 'Messages.DeleteConfirm' | translate }}</p>
    <button type="button" class="btn btn-danger" (click)="deleteBillConfirm()">
      <p>{{ 'LABELS.CONFIRM' | translate }}</p>
    </button>
    <button type="button" class="btn btn-default" (click)="modalRef.hide()">{{ 'LABELS.EXITE' | translate }}</button>
  </div>
</ng-template>
